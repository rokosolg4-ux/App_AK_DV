<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Номенклатура PRO | АВТОКРАСКИ ДВ</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --bg: #f2f2f7; --accent: #14d2a0; --text: #1c2e4a; }
        body { font-family: sans-serif; background: var(--bg); margin: 0; display: flex; height: 100vh; }
        
        /* Боковая панель (Папки) */
        .sidebar { width: 280px; background: #fff; border-right: 1px solid #ddd; padding: 20px; overflow-y: auto; }
        .category-item { padding: 10px; cursor: pointer; border-radius: 8px; margin-bottom: 5px; transition: 0.2s; }
        .category-item:hover { background: #f0f0f5; }
        .category-item i { margin-right: 10px; color: #95a5a6; }

        /* Основная зона (Товары) */
        .main-content { flex: 1; padding: 25px; overflow-y: auto; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; }
        
        /* Карточка товара как в 1С/PRO */
        .product-card { 
            background: #fff; border-radius: 20px; padding: 20px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.03); position: relative;
        }
        .sku { font-size: 10px; color: #95a5a6; text-transform: uppercase; }
        .product-name { font-weight: 700; margin: 10px 0; font-size: 15px; color: var(--text); }
        .price-tag { color: var(--accent); font-size: 18px; font-weight: 800; }
        .stock-badge { 
            position: absolute; top: 15px; right: 15px; 
            background: #eefcf8; color: var(--accent); 
            padding: 4px 10px; border-radius: 10px; font-size: 12px; font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="sidebar" id="categories-tree">
        <h3><i class="fa-solid fa-folder-tree"></i> Категории</h3>
        </div>
    <div class="main-content">
        <div class="product-grid" id="products-list">
            </div>
    </div>

    <script>
        const API = 'http://193.124.9.12:3000/api';

        async function init() {
            // Грузим категории
            const catRes = await fetch(`${API}/categories`);
            const categories = await catRes.json();
            document.getElementById('categories-tree').innerHTML += categories.map(c => `
                <div class="category-item" onclick="loadProducts(${c.id})">
                    <i class="fa-solid fa-folder"></i> ${c.name}
                </div>
            `).join('');

            loadProducts(); // Грузим всё при старте
        }

        async function loadProducts(catId = null) {
            const url = catId ? `${API}/stock?category=${catId}` : `${API}/stock`;
            const res = await fetch(url);
            const data = await res.json();
            
            document.getElementById('products-list').innerHTML = data.map(p => `
                <div class="product-card">
                    <div class="sku">${p.sku || 'Нет артикула'}</div>
                    <div class="stock-badge">${Math.round(p.qty)} шт.</div>
                    <div class="product-name">${p.product_name}</div>
                    <div class="price-tag">${p.price || 0} ₽</div>
                </div>
            `).join('');
        }
        init();
    </script>
</body>
</html>