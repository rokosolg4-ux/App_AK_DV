<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Номенклатура | AK OS</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* --- ДИЗАЙН СИСТЕМЫ (ТЕМНЫЙ ПРОФЕССИОНАЛЬНЫЙ) --- */
        :root {
            --bg-body: #1e1e1e;       /* Основной фон */
            --bg-panel: #252526;      /* Фон панелей */
            --border: #3e3e42;        /* Границы */
            --accent: #007acc;        /* Акцент (синий) */
            --text-main: #d4d4d4;     /* Текст основной */
            --text-dim: #858585;      /* Текст тусклый */
            --folder: #dcb67a;        /* Цвет папок (как в 1С/Windows) */
            --row-hover: #2a2d2e;     /* Цвет строки при наведении */
            --selection: #094771;     /* Цвет выделения */
            --green-stock: #4ec9b0;   /* Цвет наличия */
        }

        body {
            margin: 0;
            background-color: var(--bg-body);
            color: var(--text-main);
            font-family: 'Segoe UI', Tahoma, sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* 1. ПАНЕЛЬ ИНСТРУМЕНТОВ (ВЕРХНЯЯ) */
        .toolbar {
            height: 42px;
            background-color: #333333;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            padding: 0 10px;
            gap: 6px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 10;
        }

        .tool-btn {
            background: #2d2d2d;
            border: 1px solid #444;
            color: var(--text-main);
            padding: 5px 12px;
            font-size: 13px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            border-radius: 3px;
            transition: 0.2s;
            text-decoration: none;
        }

        .tool-btn:hover { background-color: #444; border-color: #555; }
        .tool-btn.primary { background-color: #fce100; color: #111; font-weight: 600; border: none; }
        .tool-btn.primary:hover { background-color: #e6cd00; }

        .search-box {
            background: #1e1e1e;
            border: 1px solid var(--border);
            color: white;
            padding: 5px 10px;
            margin-left: 10px;
            width: 250px;
            border-radius: 3px;
        }

        /* 2. РАБОЧАЯ ОБЛАСТЬ (Сплит: Таблица + Дерево) */
        .workspace {
            display: flex;
            flex: 1;
            height: calc(100vh - 42px);
        }

        /* ЛЕВАЯ ЧАСТЬ: ТАБЛИЦА ТОВАРОВ */
        .grid-view {
            flex: 1;
            overflow: auto;
            border-right: 1px solid var(--border);
            background-color: var(--bg-panel);
        }

        table { width: 100%; border-collapse: collapse; table-layout: fixed; }
        
        th {
            background-color: #2d2d30;
            color: var(--text-dim);
            font-weight: 600;
            text-align: left;
            padding: 8px 10px;
            border-right: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
            font-size: 12px;
            position: sticky;
            top: 0;
            z-index: 5;
        }

        td {
            padding: 6px 10px;
            border-right: 1px solid #333;
            border-bottom: 1px solid #333;
            font-size: 13px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        tr:hover { background-color: var(--row-hover); cursor: pointer; }
        
        /* ПРАВАЯ ЧАСТЬ: ДЕРЕВО ПАПОК */
        .tree-view {
            width: 350px; /* Ширина панели дерева */
            background-color: #252526;
            overflow-y: auto;
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
        }

        .tree-header {
            padding: 10px;
            background-color: #2d2d30;
            font-size: 12px;
            font-weight: bold;
            color: var(--text-dim);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Элементы дерева */
        .tree-node {
            display: flex;
            align-items: center;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 13px;
            white-space: nowrap;
            color: #ccc;
        }

        .tree-node:hover { background-color: var(--row-hover); color: white; }
        .tree-node.active { background-color: #37373d; font-weight: bold; }
        
        .tree-icon { color: var(--folder); margin-right: 8px; font-size: 14px; width: 16px; text-align: center; }
        .tree-expander { color: var(--text-dim); width: 16px; text-align: center; font-size: 10px; margin-right: 2px; }

        /* Отступы для иерархии */
        .indent-0 { padding-left: 5px; }
        .indent-1 { padding-left: 25px; }
        .indent-2 { padding-left: 45px; }

        /* Прокрутка (Scrollbar) */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1e1e1e; }
        ::-webkit-scrollbar-thumb { background: #444; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }

    </style>
</head>
<body>

    <div class="toolbar">
        <a href="index.html" class="tool-btn"><i class="fa-solid fa-arrow-left"></i> Назад</a>
        
        <button class="tool-btn primary"><i class="fa-solid fa-plus"></i> Создать</button>
        <button class="tool-btn"><i class="fa-solid fa-folder-plus"></i> Группу</button>
        
        <div style="width:1px; height:20px; background:#555; margin:0 5px;"></div>
        
        <button class="tool-btn"><i class="fa-solid fa-pen"></i> Изменить</button>
        <button class="tool-btn"><i class="fa-solid fa-copy"></i> Копировать</button>
        <button class="tool-btn"><i class="fa-solid fa-print"></i> Печать</button>
        
        <div style="flex:1"></div> <input type="text" class="search-box" placeholder="Поиск (Ctrl+F)">
        <button class="tool-btn"><i class="fa-solid fa-gear"></i> Еще</button>
    </div>

    <div class="workspace">
        
        <div class="grid-view">
            <table>
                <thead>
                    <tr>
                        <th style="width: 35px; text-align: center;"><i class="fa-solid fa-paperclip"></i></th>
                        <th style="width: 40%;">Наименование</th>
                        <th style="width: 15%;">Артикул</th>
                        <th style="width: 10%;">Ед.</th>
                        <th style="width: 15%;">Остаток</th>
                        <th style="width: 15%;">Цена</th>
                    </tr>
                </thead>
                <tbody id="product-list">
                    <tr><td colspan="6" style="padding:20px; text-align:center; color:#666;">Загрузка данных с сервера...</td></tr>
                </tbody>
            </table>
        </div>

        <div class="tree-view">
            <div class="tree-header">
                <span>ИЕРАРХИЯ НОМЕНКЛАТУРЫ</span>
                <i class="fa-solid fa-filter" style="cursor:pointer;" title="Фильтр"></i>
            </div>
            <div id="folder-tree">
                
                <div class="tree-node indent-0"><span class="tree-expander"><i class="fa-solid fa-caret-right"></i></span><i class="fa-solid fa-folder tree-icon"></i> ! Услуги</div>
                <div class="tree-node indent-0"><span class="tree-expander"><i class="fa-solid fa-caret-right"></i></span><i class="fa-solid fa-folder tree-icon"></i> КРАСКА СКЛАД</div>
                <div class="tree-node indent-0"><span class="tree-expander"><i class="fa-solid fa-caret-right"></i></span><i class="fa-solid fa-folder tree-icon"></i> Краска (Max Paint подбор)</div>
                <div class="tree-node indent-0"><span class="tree-expander"><i class="fa-solid fa-caret-right"></i></span><i class="fa-solid fa-folder tree-icon"></i> Краска (Max Paint слив)</div>
                <div class="tree-node indent-0"><span class="tree-expander"><i class="fa-solid fa-caret-right"></i></span><i class="fa-solid fa-folder tree-icon"></i> Краска LeTech подбор</div>
                <div class="tree-node indent-0"><span class="tree-expander"><i class="fa-solid fa-caret-right"></i></span><i class="fa-solid fa-folder tree-icon"></i> Краска LeTech слив</div>
                <div class="tree-node indent-0"><span class="tree-expander"><i class="fa-solid fa-caret-right"></i></span><i class="fa-solid fa-folder tree-icon"></i> Краска европейская (VIKA)</div>
                <div class="tree-node indent-0"><span class="tree-expander"><i class="fa-solid fa-caret-right"></i></span><i class="fa-solid fa-folder tree-icon"></i> Краска европейская слив</div>
                <div class="tree-node indent-0"><span class="tree-expander"><i class="fa-solid fa-caret-right"></i></span><i class="fa-solid fa-folder tree-icon"></i> Краска Спец тех.</div>
                <div class="tree-node indent-0"><span class="tree-expander"><i class="fa-solid fa-caret-right"></i></span><i class="fa-solid fa-folder tree-icon"></i> Краска цвета Эксклюзив</div>
                <div class="tree-node indent-0"><span class="tree-expander"><i class="fa-solid fa-caret-right"></i></span><i class="fa-solid fa-folder tree-icon"></i> Краска японская (KANSAI)</div>
                <div class="tree-node indent-0"><span class="tree-expander"><i class="fa-solid fa-caret-right"></i></span><i class="fa-solid fa-folder tree-icon"></i> Краска японская (ROCK PAINT)</div>
                
                <div class="tree-node indent-0 active" style="background-color: #37373d;">
                    <span class="tree-expander"><i class="fa-solid fa-caret-down"></i></span>
                    <i class="fa-solid fa-folder-open tree-icon" style="color: #ffcc00;"></i> 
                    Материалы
                </div>
                
                <div class="tree-node indent-1"><i class="fa-solid fa-folder tree-icon"></i> Абразивные материалы</div>
                <div class="tree-node indent-1"><i class="fa-solid fa-folder tree-icon"></i> Борфрезы</div>
                <div class="tree-node indent-1"><i class="fa-solid fa-folder tree-icon"></i> Бумага абразивная водостойкая</div>
                <div class="tree-node indent-1"><i class="fa-solid fa-folder tree-icon"></i> Бумага для сухой шлифовки</div>
                <div class="tree-node indent-1"><i class="fa-solid fa-folder tree-icon"></i> Губки абразивные</div>
                <div class="tree-node indent-1"><i class="fa-solid fa-folder tree-icon"></i> Круги зачистные</div>
                <div class="tree-node indent-1"><i class="fa-solid fa-folder tree-icon"></i> Скотч Брайт</div>
                <div class="tree-node indent-1"><i class="fa-solid fa-folder tree-icon"></i> Полировальные пасты</div>
                <div class="tree-node indent-1"><i class="fa-solid fa-folder tree-icon"></i> Автохимия и Оборудование</div>

                <div class="tree-node indent-0"><span class="tree-expander"><i class="fa-solid fa-caret-right"></i></span><i class="fa-solid fa-folder tree-icon"></i> Нужды компании</div>
                <div class="tree-node indent-0"><span class="tree-expander"><i class="fa-solid fa-caret-right"></i></span><i class="fa-solid fa-folder tree-icon"></i> Подарочный материал</div>
                <div class="tree-node indent-0"><span class="tree-expander"><i class="fa-solid fa-caret-right"></i></span><i class="fa-solid fa-folder tree-icon"></i> Тара</div>
                <div class="tree-node indent-0"><span class="tree-expander"><i class="fa-solid fa-caret-right"></i></span><i class="fa-solid fa-folder tree-icon"></i> Химия розлив, пленка</div>
                <div class="tree-node indent-0"><span class="tree-expander"><i class="fa-solid fa-caret-right"></i></span><i class="fa-solid fa-folder tree-icon"></i> Я Разное</div>
            </div>
        </div>

    </div>

    <script>
        // АДРЕС СЕРВЕРА
        const API_URL = 'http://193.124.9.12:3000/api/stock';

        async function loadNomenclature() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error('Нет связи с сервером');
                const data = await response.json();
                
                const tbody = document.getElementById('product-list');
                tbody.innerHTML = '';

                if (data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="padding:20px; text-align:center; color:#666;">Нет товаров</td></tr>';
                    return;
                }

                data.forEach(item => {
                    // Определяем стиль для остатка (зеленый если есть, красный если мало)
                    const stockStyle = item.qty > 0 ? 'color: var(--green-stock); font-weight:bold;' : 'color: #ff5555;';
                    
                    const row = `
                        <tr>
                            <td style="text-align:center; color:#555;"><i class="fa-solid fa-box"></i></td>
                            <td style="font-weight:500;">
                                ${item.product_name}
                                <div style="font-size:11px; color:#888;">${item.variant}</div>
                            </td>
                            <td>${item.sku || '-'}</td>
                            <td>шт</td>
                            <td style="${stockStyle}">${item.qty}</td>
                            <td style="color: #61afef;">${item.price} ₽</td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });
            } catch (error) {
                console.error(error);
                document.getElementById('product-list').innerHTML = 
                    '<tr><td colspan="6" style="padding:20px; text-align:center; color:red;">Ошибка загрузки данных! Сервер не отвечает.</td></tr>';
            }
        }

        // Запуск при открытии страницы
        loadNomenclature();
    </script>

</body>
</html>

<div class="product-grid" id="product-list">
    </div>

<script>
async function loadNomenclature(categoryId = null) {
    const response = await fetch(`http://193.124.9.12:3000/api/products?category=${categoryId}`);
    const products = await response.json();
    
    const container = document.getElementById('product-list');
    container.innerHTML = products.map(p => `
        <div class="product-card" onclick="openProductCard(${p.id})">
            <div class="product-info">
                <span class="sku">Арт: ${p.sku || '---'}</span>
                <h4>${p.name}</h4>
                <div class="price">${p.price} ₽</div>
            </div>
            <div class="stock-badge ${p.qty > 0 ? 'in-stock' : 'out-of-stock'}">
                ${p.qty} ${p.unit || 'шт'}
            </div>
        </div>
    `).join('');
}
</script>